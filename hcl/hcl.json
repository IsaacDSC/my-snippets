{
	"nomad-service": {
		"prefix": "nomadservice",
		"body": [
			"job \"${1:serviceName}\" {",
			"  datacenters = [\"dc1\"]",
			"\n",
			"  group \"${2:groupoName}\" {",
			"    count = 3",
			"    network {",
			"      port \"http\" {",
		    "        to = -1",
			"      }",
			"    }",
			"\n",
			"    restart {",
			"      attempts = 10",
			"      delay    = \"30s\"",
			"      mode     = \"fail\"",
			"    }",
			"\n",
			"    scaling {",
			"      enabled = true",
			"      min     = 1",
			"      max     = 10",
			"\n",
			"      policy {",
			"      check \"96pct\" {",
			"        strategy \"app-sizing-percentile\" {",
			"          percentile = \"70\"",
			"         }",
			"       }",
			"     }",
			"   }",
			"\n",
			"    service {",
			"      name = \"${1:serviceName}\"",
			"      port = \"http\"",
			"\n",
			"      check {",
			"        type     = \"http\"",
			"        path     = \"/\"",
			"        interval = \"2s\"",
			"        timeout  = \"2s\"",
			"        header {",
			"          Authorization = [\"Basic ZWxhc3RpYzpjaGFuZ2VtZQ==\"]",
			"        }",
			"      }",
			"    }",
			"\n",
			"    task \"${3:taskName}\" {",
			"      env {",
			"        PORT    = \"${NOMAD_PORT_http}\"",
			"        NODE_IP = \"${NOMAD_IP_http}\"",
			"      }",
			"\n",
			"      driver = \"docker\"",
			"\n",
			"      config {",
			"        image = \"isaacdsc/balancer_nomad_app:latest\"",
			"        ports = [\"http\"]",
			"      }",
			"\n",
			"      resources {",
			"        cpu    = 2000 # MHz",
			"        memory = 500 # MB",
			"      }",
			"    }",
			"  }",
			"}"
		]
	},
	"nomad-balancer":{
		"prefix": "nomadbalancernginx",
		"body": [
			"job \"nginx\" {",
			"  datacenters = [\"dc1\"]",
			"\n",
			"  group \"nginx\" {",
			"    count = 1",
			"\n",
			"    network {",
			"      port \"http\" {",
			"        static = ${2:port}",
			"      }",
			"    }",
			"\n",
			"  service {",
			"    name = \"nginx\"",
			"    port = \"http\"",
			"  }",
			"\n",
			"  task \"nginx\" {",
			"    driver = \"docker\"",
			"\n",
			"    config {",
			"      image = \"nginx\"",
			"\n",
			"      ports = [\"http\"]",
			"\n",
			"      volumes = [",
			"        \"local:/etc/nginx/conf.d\",",
			"      ]",
			"    }",
			"\n",
			"  template {",
			"    data = <<EOF",
			"    upstream backend {",
			"    {{ range service \"${1:serviceName}\" }}",
			"     server {{ .Address }}:{{ .Port }};",
			"    {{ else }}server 127.0.0.1:65535; # force a 502",
			"    {{ end }}",
			"  }",
			"\n",
			"  server {",
			"    listen 8080;",
			"\n",
			"    location / {",
			"      proxy_pass http://backend;",
			"    }",
			"  }",
			"  EOF",
			"\n",
			"    destination   = \"local/load-balancer.conf\"",
			"      change_mode   = \"signal\"",
			"      change_signal = \"SIGHUP\"",
			"      }",
			"    }",
			"  }",
			"}"
		]
	}
}